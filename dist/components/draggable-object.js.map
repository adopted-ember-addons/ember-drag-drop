{"version":3,"file":"draggable-object.js","sources":["../../src/components/draggable-object.hbs","../../src/components/draggable-object.js"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"{{#if @enableClicking}}\\n  <a href=\\\"#\\\" {{fn this.selectForDrag}}>\\n    {{yield}}\\n  </a>\\n{{else}}\\n  {{yield}}\\n{{/if}}\")","/* eslint-disable ember/no-actions-hash, ember/no-classic-classes, ember/no-classic-components, ember/no-component-lifecycle-hooks, ember/no-get, ember/no-incorrect-calls-with-inline-anonymous-functions, ember/require-super-in-lifecycle-hooks, ember/require-tagless-components, import/extensions, prettier/prettier */\nimport { getOwner } from '@ember/application';\nimport Component from '@ember/component';\nimport { inject as service} from '@ember/service';\nimport { alias } from '@ember/object/computed';\nimport { computed } from '@ember/object';\nimport { scheduleOnce, next } from '@ember/runloop';\nimport { set } from '@ember/object';\nimport { wrapper } from '../utils/proxy-unproxy-objects';\n\nexport default Component.extend({\n  dragCoordinator: service('drag-coordinator'),\n  overrideClass: 'draggable-object',\n  classNameBindings: [':js-draggableObject','isDraggingObject:is-dragging-object:', 'overrideClass'],\n  attributeBindings: ['dragReady:draggable'],\n  isDraggable: true,\n  dragReady: true,\n  isSortable: false,\n  sortingScope: 'drag-objects',\n  title: alias('content.title'),\n\n  // idea taken from https://github.com/emberjs/rfcs/blob/master/text/0680-implicit-injection-deprecation.md#stage-1\n  get coordinator() {\n    if (this._coordinator === undefined) {\n      this._coordinator = getOwner(this).lookup('drag:coordinator');\n    }\n\n    return this._coordinator;\n  },\n  set coordinator(value) {\n    this._coordinator = value;\n  },\n\n  draggable: computed('isDraggable', function() {\n    let isDraggable = this.get('isDraggable');\n\n    return isDraggable || null;\n  }),\n\n  proxyContent: computed('content', function() {\n    return wrapper(this.get('content'));\n  }),\n\n\n  init() {\n    this._super(...arguments);\n    if (this.get('dragHandle')) {\n      this.set('dragReady', false);\n    }\n\n    this.mouseOverHandler = function() {\n      this.set('dragReady', true);\n    }.bind(this);\n    this.mouseOutHandler = function() {\n      this.set('dragReady', false);\n    }.bind(this);\n\n  },\n\n  didInsertElement() {\n    scheduleOnce('afterRender', () => {\n      //if there is a drag handle watch the mouse up and down events to trigger if drag is allowed\n      let dragHandle = this.get('dragHandle');\n      if (dragHandle) {\n        //only start when drag handle is activated\n        if (this.element.querySelector(dragHandle)) {\n          this.element.querySelector(dragHandle).addEventListener('mouseover', this.mouseOverHandler);\n          this.element.querySelector(dragHandle).addEventListener('mouseout', this.mouseOutHandler);\n        }\n      }\n    });\n  },\n\n  willDestroyElement(){\n    let dragHandle = this.get('dragHandle');\n    if (this.element.querySelector(dragHandle)) {\n      this.element.querySelector(dragHandle).removeEventListener('mouseover', this.mouseOverHandler);\n      this.element.querySelector(dragHandle).removeEventListener('mouseout', this.mouseOutHandler);\n    }\n  },\n\n\n  dragStart(event) {\n    if (!this.get('isDraggable') || !this.get('dragReady')) {\n      event.preventDefault();\n      return;\n    }\n\n    let dataTransfer = event.dataTransfer;\n\n    let obj = this.get('proxyContent');\n    let id = null;\n    let coordinator = this.get('coordinator');\n    if (coordinator) {\n       id = coordinator.setObject(obj, { source: this });\n    }\n\n    dataTransfer.setData('Text', id);\n\n    if (obj && typeof obj === 'object') {\n      set(obj, 'isDraggingObject', true);\n    }\n    this.set('isDraggingObject', true);\n    if (!this.get('dragCoordinator.enableSort') && this.get('dragCoordinator.sortComponentController')) {\n      //disable drag if sorting is disabled this is not used for regular\n      event.preventDefault();\n      return;\n    } else {\n      next(()=> {\n        this.dragStartHook(event);\n      });\n      this.get('dragCoordinator').dragStarted(obj, event, this);\n    }\n\n    if( this.get('dragStartAction')) {\n      this.get('dragStartAction')(obj, event);\n    }\n\n    if (this.get('isSortable') && this.get('draggingSortItem')) {\n      this.get('draggingSortItem')(obj, event);\n    }\n  },\n\n  dragEnd(event) {\n    if (!this.get('isDraggingObject')) {\n      return;\n    }\n\n    let obj = this.get('proxyContent');\n\n    if (obj && typeof obj === 'object') {\n      set(obj, 'isDraggingObject', false);\n    }\n    this.set('isDraggingObject', false);\n    this.dragEndHook(event);\n    this.get('dragCoordinator').dragEnded();\n    if(this.get('dragEndAction')) {\n      this.get('dragEndAction')(obj, event);\n    }\n    if (this.get('dragHandle')) {\n      this.set('dragReady', false);\n    }\n  },\n\n  drag(event) {\n    if(this.get('dragMoveAction')) {\n      this.get('dragMoveAction')(event);\n    }\n  },\n\n  dragOver(event) {\n   if (this.get('isSortable')) {\n     this.get('dragCoordinator').draggingOver(event, this);\n   }\n    return false;\n  },\n\n  dragStartHook(event) {\n    event.target.style.opacity = '0.5';\n  },\n\n  dragEndHook(event) {\n    event.target.style.opacity = '1';\n  },\n\n  drop(event) {\n    //Firefox is navigating to a url on drop, this prevents that from happening\n    event.preventDefault();\n  },\n\n  actions: {\n    selectForDrag() {\n      let obj = this.get('proxyContent');\n      let hashId = this.get('coordinator').setObject(obj, { source: this });\n      this.set('coordinator.clickedId', hashId);\n    }\n  }\n});\n"],"names":["setComponentTemplate","TEMPLATE","Component","extend","dragCoordinator","service","overrideClass","classNameBindings","attributeBindings","isDraggable","dragReady","isSortable","sortingScope","title","alias","coordinator","_coordinator","undefined","getOwner","lookup","value","draggable","computed","get","proxyContent","wrapper","init","_super","arguments","set","mouseOverHandler","bind","mouseOutHandler","didInsertElement","scheduleOnce","dragHandle","element","querySelector","addEventListener","willDestroyElement","removeEventListener","dragStart","event","preventDefault","dataTransfer","obj","id","setObject","source","setData","next","dragStartHook","dragStarted","dragEnd","dragEndHook","dragEnded","drag","dragOver","draggingOver","target","style","opacity","drop","actions","selectForDrag","hashId"],"mappings":"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"}